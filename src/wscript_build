import os

obj = bld.new_task_gen('cxx', 'shlib', 'node_addon')
obj.target = 'binding'
obj.uselib = 'DNS_SD'
obj.includes = ['..']
obj.source = [ 'binding.cpp'
             , 'dns_service_browse.cpp'
             , 'dns_service_enumerate_domains.cpp'
             , 'dns_service_process_result.cpp'
             , 'dns_service_ref.cpp'
             , 'dns_service_ref_deallocate.cpp'
             , 'dns_service_ref_sock_fd.cpp'
             , 'dns_service_register.cpp'
             , 'dns_service_resolve.cpp'
             , 'mdns_utils.cpp'
             ]
if bld.env.HAVE_DNSSERVICEGETADDRINFO:
  obj.source.append('dns_service_get_addr_info.cpp')

def post_build(ctx):
  target = obj.env['shlib_PATTERN'] % obj.target
  symlink_path = os.path.join('lib', target)
  if os.path.lexists(symlink_path):
    os.unlink(symlink_path)
  path_to_addon = os.path.join('..', 'build', ctx.path.bld_dir(ctx.env), 'src',
          target)
  os.symlink(path_to_addon, symlink_path)


bld.add_post_fun(post_build)

# vim: set filetype=python :
